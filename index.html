<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Immotools ‚Äì Neues 6‚ÄëSpalten Layout</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#0e1117; --ink:#e8ecf3; --soft:#a8b3c7;
  --card:#111827; --border:#1f2937;
  --brand:#06c2a8; --accent:#ffd159; --muted:#7f8aa3;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
.header{position:sticky;top:0;z-index:10;background:rgba(17,24,39,.9);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
.header .row{display:flex;align-items:center;gap:16px;padding:14px 18px}
.brand{font-weight:800;letter-spacing:.2px}
.nav{margin-left:auto;display:flex;gap:8px}
.nav button{background:#0f1625;border:1px solid var(--border);color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
.nav button.active{background:var(--brand);color:#002822;border-color:transparent}
.wrap{max-width:2000px;margin:0 auto;padding:18px}
/* NEW LAYOUT: equal 6 columns with generous gaps; each column is a vertical stack */
.columns{display:grid;grid-template-columns:repeat(6, minmax(290px, 1fr));gap:18px;align-items:start}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:12px}
.card h2{margin:0 0 10px 0;font-size:14px;text-transform:uppercase;letter-spacing:.35px;color:#f4f7ff}
.section{border:1px dashed var(--border);border-radius:12px;padding:10px;margin-bottom:10px;background:#0b1220}
.section h3{margin:0 0 8px 0;font-size:13px;color:#e9eefc}
.tbl{width:100%;border-collapse:collapse;font-size:13px}
.tbl th,.tbl td{padding:7px;border-bottom:1px solid var(--border);vertical-align:middle}
.tbl th{color:var(--soft);text-align:left;font-weight:600}
.tbl td.val{text-align:right;white-space:nowrap;font-variant-numeric:tabular-nums}
input[type="number"], input[type="text"]{width:130px;padding:7px 8px;border-radius:10px;border:1px solid var(--border);background:#0a1220;color:var(--ink)}
input.w{width:230px}
.kpi{display:flex;justify-content:space-between;align-items:center;background:#0b1727;border:1px solid var(--border);padding:10px;border-radius:12px;margin-top:8px}
.kpi .l{color:var(--muted);font-size:12px}
.kpi .v{font-weight:800}
.note{font-size:12px;color:var(--muted)}
.hidden{display:none}
/* responsive */
@media(max-width:1700px){.columns{grid-template-columns:repeat(4,minmax(290px,1fr))}}
@media(max-width:1200px){.columns{grid-template-columns:repeat(2,minmax(290px,1fr))}}
@media(max-width:700px){.columns{grid-template-columns:1fr}}
.chartcard{grid-column:1/-1;background:#0b1324;border:1px solid var(--border);border-radius:16px;padding:14px}
.chartcard h2{display:flex;justify-content:space-between;align-items:baseline}
.badge{background:#152238;border:1px solid var(--border);padding:6px 8px;border-radius:8px;font-size:12px;color:#cfe}
</style>
</head>
<body>
<div class="header">
  <div class="row">
    <div class="brand">üè† Immotools</div>
    <div class="nav">
      <button class="active" data-tab="calc">Cockpit</button>
      <button data-tab="charts">Diagramme</button>
    </div>
  </div>
</div>

<div class="wrap">
  <!-- Tab: Calculator -->
  <div id="tab-calc">
    <div class="columns">
      <!-- Col 1 -->
      <div class="card">
        <h2>Objekt & Investition</h2>
        <div class="section">
          <h3>Objekt</h3>
          <table class="tbl">
            <tr><th>Adresse</th><td><input id="addr" class="w" type="text" value="Musterstr. 11, 12345 Musterstadt"></td></tr>
            <tr><th>Wohnfl√§che</th><td class="val"><input id="area" type="number" value="95"> m¬≤</td></tr>
            <tr><th>Stellpl√§tze</th><td class="val"><input id="slots" type="number" value="1"></td></tr>
          </table>
        </div>
        <div class="section">
          <h3>Kaufpreis & KNK</h3>
          <table class="tbl">
            <tr><th>Kaufpreis</th><td class="val"><input id="price" type="number" value="175000"> ‚Ç¨</td></tr>
            <tr><th>pro m¬≤</th><td class="val" id="priceSqm">‚Äì</td></tr>
            <tr><th>Makler</th><td class="val"><input id="fee" type="number" value="0"> %</td></tr>
            <tr><th>Notar</th><td class="val"><input id="notary" type="number" value="1.5"> %</td></tr>
            <tr><th>Grundbuchamt</th><td class="val"><input id="landreg" type="number" value="0.5"> %</td></tr>
            <tr><th>Grunderwerbsteuer</th><td class="val"><input id="taxRE" type="number" value="5"> %</td></tr>
            <tr><th>Sonstige</th><td class="val"><input id="miscAcq" type="number" value="0"> %</td></tr>
            <tr><th>Summe KNK</th><td class="val" id="knkSum">‚Äì</td></tr>
          </table>
          <div class="kpi"><div class="l">Gesamterwerb</div><div id="totalAcq" class="v">‚Äì</div></div>
        </div>
        <div class="section">
          <h3>Anf√§ngliche Investitionen</h3>
          <table class="tbl">
            <tr><th>K√ºche</th><td class="val"><input id="kitchen" type="number" value="2500"> ‚Ç¨</td></tr>
            <tr><th>Sonstiges</th><td class="val"><input id="capexOther" type="number" value="9000"> ‚Ç¨</td></tr>
            <tr><th>Summe</th><td class="val" id="capexSum">‚Äì</td></tr>
            <tr><th>15%‚ÄëGrenze</th><td class="val" id="limit15">‚Äì</td></tr>
          </table>
          <div class="kpi"><div class="l">Gesamtinvestitionskosten</div><div id="totalInvest" class="v">‚Äì</div></div>
        </div>
      </div>

      <!-- Col 2 -->
      <div class="card">
        <h2>Miete & R√ºcklagen</h2>
        <div class="section">
          <h3>Soll‚ÄëMiete mtl.</h3>
          <table class="tbl">
            <tr><th>Kaltmiete ‚Ç¨/m¬≤</th><td class="val"><input id="rentSqm" type="number" value="11.1"> ‚Ç¨</td></tr>
            <tr><th>Kaltmiete gesamt</th><td class="val" id="coldRent">‚Äì</td></tr>
            <tr><th>+ Stellpl√§tze</th><td class="val"><input id="rentSlots" type="number" value="45"> ‚Ç¨</td></tr>
            <tr><th>+ Sonstiges</th><td class="val"><input id="rentOther" type="number" value="0"> ‚Ç¨</td></tr>
            <tr><th>+ Umlagef√§hige Kosten</th><td class="val"><input id="umlagefaehig" type="number" value="399"> ‚Ç¨</td></tr>
            <tr><th>= Warmmiete</th><td class="val" id="warmRent">‚Äì</td></tr>
          </table>
        </div>
        <div class="section">
          <h3>R√ºcklagen</h3>
          <table class="tbl">
            <tr><th>Mietausfall kalk.</th><td class="val"><input id="vacancyPct" type="number" value="3"> %</td></tr>
            <tr><th>Eigene Instandh. (‚Ç¨/m¬≤¬∑a)</th><td class="val"><input id="maintPerSqmYear" type="number" value="10"> ‚Ç¨</td></tr>
          </table>
        </div>
      </div>

      <!-- Col 3 -->
      <div class="card">
        <h2>Bewirtschaftung</h2>
        <div class="section">
          <h3>Kosten pro Monat</h3>
          <table class="tbl">
            <tr><th>Umlagef√§hig (Summe)</th><td class="val" id="bwuUml">‚Äì</td></tr>
            <tr><th>Nicht umlagef√§hig</th><td class="val"><input id="nonApportion" type="number" value="173"> ‚Ç¨</td></tr>
            <tr><th>% der Nettokaltmiete</th><td class="val" id="bwuPct">‚Äì</td></tr>
            <tr><th>Insgesamt</th><td class="val" id="bwuSum">‚Äì</td></tr>
          </table>
        </div>
        <div class="section">
          <h3>Hausgeld & Anteile</h3>
          <table class="tbl">
            <tr><th>Hausgeld gesamt</th><td class="val"><input id="hausgeld" type="number" value="439"> ‚Ç¨</td></tr>
            <tr><th>Umlagef√§hig</th><td class="val"><input id="hgUml" type="number" value="390"> ‚Ç¨</td></tr>
            <tr><th>Nicht umlegbar</th><td class="val"><input id="hgNicht" type="number" value="49"> ‚Ç¨</td></tr>
            <tr><th>Grundsteuer</th><td class="val"><input id="grundsteuer" type="number" value="9"> ‚Ç¨</td></tr>
            <tr><th>WEG R√ºcklage</th><td class="val"><input id="weg" type="number" value="23"> ‚Ç¨</td></tr>
          </table>
        </div>
        <div class="section">
          <h3>Summen</h3>
          <table class="tbl">
            <tr><th>Umlagef√§hige Kosten</th><td class="val" id="umlagSum">‚Äì</td></tr>
            <tr><th>Eigene Instandhaltungsr√ºckl.</th><td class="val" id="eigeneRueckl">‚Äì</td></tr>
            <tr><th>Mietausfall (kalk.)</th><td class="val" id="leerstandEuro">‚Äì</td></tr>
            <tr><th>Nicht umlagef√§hige Kosten</th><td class="val" id="nichtUmlSum">‚Äì</td></tr>
          </table>
        </div>
      </div>

      <!-- Col 4 -->
      <div class="card">
        <h2>Finanzierung</h2>
        <div class="section">
          <h3>Gesamt</h3>
          <table class="tbl">
            <tr><th>Eigenkapital %</th><td class="val"><input id="equityPct" type="number" value="13"> %</td></tr>
            <tr><th>Zinssatz</th><td class="val"><input id="interestPct" type="number" value="3.69"> %</td></tr>
            <tr><th>Anfangstilgung</th><td class="val"><input id="repaymentPct" type="number" value="2"> %</td></tr>
            <tr><th>Darlehen % Kaufpreis</th><td class="val" id="loanPct">‚Äì</td></tr>
            <tr><th>Darlehenssumme</th><td class="val" id="loan">‚Äì</td></tr>
            <tr><th>Eigenkapital</th><td class="val" id="equityAbs">‚Äì</td></tr>
            <tr><th>Annuit√§t / Monat</th><td class="val" id="annuity">‚Äì</td></tr>
            <tr><th>Volltilgung (Jahr)</th><td class="val" id="yearFull">‚Äì</td></tr>
          </table>
        </div>
        <div class="section">
          <h3>Steuern & AfA</h3>
          <table class="tbl">
            <tr><th>Geb√§udeanteil am KP</th><td class="val"><input id="buildingShare" type="number" value="75"> %</td></tr>
            <tr><th>AfA-Satz</th><td class="val"><input id="afaRate" type="number" value="2"> % p.a.</td></tr>
            <tr><th>AfA‚ÄëBasis</th><td class="val" id="afaBase">‚Äì</td></tr>
            <tr><th>AfA mtl.</th><td class="val" id="afaMonth">‚Äì</td></tr>
            <tr><th>Grenzsteuersatz</th><td class="val"><input id="taxRate" type="number" value="26"> %</td></tr>
          </table>
        </div>
      </div>

      <!-- Col 5 -->
      <div class="card">
        <h2>Kennzahlen heute</h2>
        <div class="section">
          <h3>Miete & Rendite</h3>
          <table class="tbl">
            <tr><th>Nettokaltmiete p.a.</th><td class="val" id="coldRentYear">‚Äì</td></tr>
            <tr><th>Bruttomietrendite</th><td class="val" id="grossYield">‚Äì</td></tr>
            <tr><th>Faktor</th><td class="val" id="faktor">‚Äì</td></tr>
            <tr><th>Nettomietrendite</th><td class="val" id="netYield">‚Äì</td></tr>
          </table>
        </div>
        <div class="section">
          <h3>Cashflow (Monat)</h3>
          <table class="tbl">
            <tr><th>Warmmiete</th><td class="val" id="cfWarm">‚Äì</td></tr>
            <tr><th>- Bewirtschaftung</th><td class="val" id="cfBwu">‚Äì</td></tr>
            <tr><th>- Zinsen</th><td class="val" id="cfInterest">‚Äì</td></tr>
            <tr><th>- Tilgung</th><td class="val" id="cfRepay">‚Äì</td></tr>
            <tr><th>= Operativ</th><td class="val" id="cfOper">‚Äì</td></tr>
            <tr><th>- Steuern (Sch√§tzung)</th><td class="val" id="cfTax">‚Äì</td></tr>
            <tr><th>= Nach Steuern</th><td class="val" id="cfAfterTax">‚Äì</td></tr>
          </table>
        </div>
      </div>

      <!-- Col 6 -->
      <div class="card">
        <h2>Zukunft</h2>
        <div class="section">
          <h3>Parameter</h3>
          <table class="tbl">
            <tr><th>Jahre voraus</th><td class="val"><input id="yearsFwd" type="number" value="10"></td></tr>
            <tr><th>Mietsteigerung p.a.</th><td class="val"><input id="rentGrowth" type="number" value="2"></td></tr>
            <tr><th>Kostensteigerung p.a.</th><td class="val"><input id="costGrowth" type="number" value="3"></td></tr>
            <tr><th>Wertsteigerung p.a.</th><td class="val"><input id="valueGrowth" type="number" value="2"></td></tr>
          </table>
        </div>
        <div class="section">
          <h3>Prognose</h3>
          <table class="tbl">
            <tr><th>Nettokaltmiete p.a.</th><td class="val" id="fwdRentYear">‚Äì</td></tr>
            <tr><th>Warmmiete / Monat</th><td class="val" id="fwdWarm">‚Äì</td></tr>
            <tr><th>Bewirtschaftung / Monat</th><td class="val" id="fwdBwu">‚Äì</td></tr>
            <tr><th>Zinsen / Monat</th><td class="val" id="fwdInterest">‚Äì</td></tr>
            <tr><th>Tilgung / Monat</th><td class="val" id="fwdRepay">‚Äì</td></tr>
            <tr><th>CF operativ</th><td class="val" id="fwdOper">‚Äì</td></tr>
          </table>
        </div>
      </div>

      <!-- Big Chart across all columns -->
      <div class="chartcard">
        <h2>
          Amortisations-Chart <span class="badge" id="chartBadge">‚Äì</span>
        </h2>
        <canvas id="amChart"></canvas>
        <div class="note">Stapelbalken: konstante Annuit√§t pro Jahr (Zins ‚Üì, Tilgung ‚Üë). Linie: Restschuld. Genau wie im Beispiel-Chart.</div>
      </div>
    </div>
  </div>

  <!-- Tab: Charts only (fullscreen) -->
  <div id="tab-charts" class="hidden">
    <div class="chartcard">
      <h2>Amortisations-Chart <span class="badge" id="chartBadge2">‚Äì</span></h2>
      <canvas id="amChartFull"></canvas>
    </div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
function eur(n,d=0){return (isFinite(n)?n:0).toLocaleString('de-DE',{style:'currency',currency:'EUR',maximumFractionDigits:d});}
function pct(n,d=1){return (isFinite(n)?n:0).toFixed(d)+' %';}
function y(){return new Date().getFullYear();}

// Tab switching
document.querySelectorAll('.nav button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const tab = btn.dataset.tab;
    document.getElementById('tab-calc').classList.toggle('hidden', tab!=='calc');
    document.getElementById('tab-charts').classList.toggle('hidden', tab!=='charts');
    // redraw charts when opening
    if(tab==='charts'){ render(true); }
  });
});

function read(){
  return {
    // Objekt
    area:+$('area').value||0, price:+$('price').value||0,
    fee:+$('fee').value||0, notary:+$('notary').value||0, landreg:+$('landreg').value||0, taxRE:+$('taxRE').value||0, miscAcq:+$('miscAcq').value||0,
    kitchen:+$('kitchen').value||0, capexOther:+$('capexOther').value||0,
    // Miete
    rentSqm:+$('rentSqm').value||0, rentSlots:+$('rentSlots').value||0, rentOther:+$('rentOther').value||0, umlagefaehig:+$('umlagefaehig').value||0,
    // R√ºcklagen
    vacancyPct:+$('vacancyPct').value||0, maintPerSqmYear:+$('maintPerSqmYear').value||0,
    // Bewirtschaftung
    nonApportion:+$('nonApportion').value||0, hausgeld:+$('hausgeld').value||0, hgUml:+$('hgUml').value||0, grundsteuer:+$('grundsteuer').value||0, hgNicht:+$('hgNicht').value||0, weg:+$('weg').value||0,
    // Finanzierung
    equityPct:+$('equityPct').value||0, interestPct:+$('interestPct').value||0, repaymentPct:+$('repaymentPct').value||0, buildingShare:+$('buildingShare').value||0, afaRate:+$('afaRate').value||0, taxRate:+$('taxRate').value||0,
    // Zukunft
    yearsFwd:+$('yearsFwd').value||0, rentGrowth:+$('rentGrowth').value||0, costGrowth:+$('costGrowth').value||0, valueGrowth:+$('valueGrowth').value||0
  };
}

function calc(p){
  const priceSqm = p.area>0 ? p.price/p.area : 0;
  const knkPct = (p.fee+p.notary+p.landreg+p.taxRE+p.miscAcq)/100;
  const knkSum = p.price*knkPct;
  const totalAcq = p.price + knkSum;
  const capexSum = p.kitchen + p.capexOther;
  const totalInvest = totalAcq + capexSum;

  const coldRent = p.area*p.rentSqm;
  const coldRentWithExtras = coldRent + p.rentSlots + p.rentOther;
  const warmRent = coldRentWithExtras + p.umlagefaehig;

  const umlagSum = p.hgUml + p.grundsteuer;
  const eigeneRueckl = (p.area*p.maintPerSqmYear)/12;
  const leerstandEuro = coldRentWithExtras*(p.vacancyPct/100);
  const nichtUmlSum = p.hgNicht + p.weg + eigeneRueckl + leerstandEuro;
  const bwuSum = umlagSum + p.nonApportion + nichtUmlSum;
  const bwuPct = coldRentWithExtras>0 ? (bwuSum/coldRentWithExtras*100) : 0;

  const equityAbs = totalAcq*(p.equityPct/100);
  const loan = Math.max(totalAcq - equityAbs,0);
  const annuity = loan*((p.interestPct + p.repaymentPct)/100/12);
  const interestMonth = loan*(p.interestPct/100/12);
  const repayMonth = annuity - interestMonth;

  // AfA-Basis: Geb√§udeanteil √ó (KP + KNK)
  const afaBase = (p.price + knkSum) * (p.buildingShare/100);
  const afaMonth = afaBase*(p.afaRate/100)/12;
  const bwuForTax = umlagSum + p.nonApportion + p.hgNicht + p.weg;
  const taxable = Math.max(0, warmRent - bwuForTax - interestMonth - afaMonth);
  const taxMonth = taxable*(p.taxRate/100);

  const cfOper = warmRent - bwuSum - annuity;
  const cfAfterTax = cfOper - taxMonth + repayMonth;

  // Renditen
  const coldYear = coldRentWithExtras*12;
  const grossYield = p.price>0 ? coldYear/p.price*100 : 0;
  const faktor = coldYear>0 ? p.price/coldYear : 0;
  const netYield = totalInvest>0 ? ((coldYear - (nichtUmlSum+p.nonApportion)*12)/totalInvest*100) : 0;

  // Zukunft
  const coldYearFwd = coldYear*Math.pow(1+p.rentGrowth/100,p.yearsFwd);
  const warmFwd = (coldYearFwd/12) + p.umlagefaehig;
  const bwuFwd = bwuSum*Math.pow(1+p.costGrowth/100,p.yearsFwd);

  // 15%-Grenze (vereinfachte Form wie Screenshot)
  const limit15 = 0.15*(p.buildingShare/100)*(p.price+knkSum)*1.19;

  // Volltilgungsjahr (Annuit√§t)
  let nMonths=0; const im=p.interestPct/100/12;
  if(im>0 && annuity>im*loan){ nMonths=Math.log(annuity/(annuity-im*loan))/Math.log(1+im); }
  const fullYear = Math.floor(new Date().getFullYear() + nMonths/12);

  return {
    priceSqm, knkSum, totalAcq, capexSum, totalInvest, limit15,
    coldRent, coldRentWithExtras, warmRent, umlagSum, eigeneRueckl, leerstandEuro, nichtUmlSum, bwuSum, bwuPct,
    equityAbs, loan, annuity, interestMonth, repayMonth,
    coldYear, grossYield, faktor, netYield, afaBase, afaMonth, taxMonth, cfOper, cfAfterTax,
    coldYearFwd, warmFwd, bwuFwd, fullYear
  };
}

let amSmall, amFull;

function drawAmort(p, m){
  const months = 35*12; // up to 35y window
  const r = p.interestPct/100/12;
  const loan = m.loan;
  const ann = m.annuity;
  let bal = loan;
  const labels=[], z=[], t=[], rest=[];
  let payoffYear = null;
  for(let k=1;k<=months;k++){
    const interest = bal*r;
    const repay = Math.min(ann - interest, bal);
    bal = Math.max(0, bal - repay);
    if(k%12===0){
      labels.push('J'+(k/12));
      z.push(interest*12);
      t.push(repay*12);
      rest.push(bal);
      if(payoffYear===null && bal<=0){ payoffYear = Math.floor(new Date().getFullYear()+k/12); }
      if(bal<=0) break;
    }
  }
  const ds = [
    {label:'Zinsen/Jahr', data:z, stack:'cf'},
    {label:'Tilgung/Jahr', data:t, stack:'cf'}
  ];

  const badge = `Annuit√§t/Jahr: ${eur(m.annuity*12)} ‚Ä¢ Laufzeit: ~${labels.length} Jahre`;
  $('chartBadge').textContent = badge;
  $('chartBadge2').textContent = badge;

  const cfg = (ctx)=> ({
    type:'bar',
    data:{ labels, datasets: ds },
    options:{
      plugins:{legend:{position:'top'}},
      responsive:true,
      scales:{ y:{ beginAtZero:true }, x:{ stacked:true }, yAxes:{ stacked:true } }
    }
  });

  if(amSmall) amSmall.destroy();
  amSmall = new Chart(document.getElementById('amChart').getContext('2d'), cfg());
  if(!document.getElementById('tab-charts').classList.contains('hidden')){
    if(amFull) amFull.destroy();
    amFull = new Chart(document.getElementById('amChartFull').getContext('2d'), cfg());
  }
}

function render(onlyCharts=false){
  const p = read();
  const m = calc(p);

  if(!onlyCharts){
    // Col1
    $('priceSqm').textContent = eur(m.priceSqm,0);
    $('knkSum').textContent = eur(m.knkSum);
    $('totalAcq').textContent = eur(m.totalAcq);
    $('capexSum').textContent = eur(m.capexSum);
    $('limit15').textContent = eur(m.limit15);
    $('totalInvest').textContent = eur(m.totalInvest);
    // Col2
    $('coldRent').textContent = eur(m.coldRent);
    $('warmRent').textContent = eur(m.warmRent);
    // Col3
    $('bwuUml').textContent = eur(m.umlagSum);
    $('eigeneRueckl').textContent = eur(m.eigeneRueckl);
    $('leerstandEuro').textContent = eur(m.leerstandEuro);
    $('nichtUmlSum').textContent = eur(m.nichtUmlSum);
    $('bwuSum').textContent = eur(m.bwuSum);
    $('bwuPct').textContent = pct(m.bwuPct);
    $('umlagSum').textContent = eur(m.umlagSum);
    // Col4
    $('loanPct').textContent = pct(m.loan/(p.price||1)*100,1);
    $('loan').textContent = eur(m.loan);
    $('equityAbs').textContent = eur(m.equityAbs);
    $('annuity').textContent = eur(m.annuity);
    $('yearFull').textContent = m.fullYear;
    $('afaBase').textContent = eur(m.afaBase);
    $('afaMonth').textContent = eur(m.afaMonth);
    // Col5
    $('coldRentYear').textContent = eur(m.coldYear);
    $('grossYield').textContent = pct(m.grossYield);
    $('faktor').textContent = (isFinite(m.faktor)?m.faktor:0).toFixed(1);
    $('netYield').textContent = pct(m.netYield);
    $('cfWarm').textContent = eur(m.warmRent);
    $('cfBwu').textContent = eur(m.bwuSum);
    $('cfInterest').textContent = eur(m.interestMonth);
    $('cfRepay').textContent = eur(m.repayMonth);
    $('cfOper').textContent = eur(m.cfOper);
    $('cfTax').textContent = eur(m.taxMonth);
    $('cfAfterTax').textContent = eur(m.cfAfterTax);
    // Col6
    $('fwdRentYear').textContent = eur(m.coldYearFwd);
    $('fwdWarm').textContent = eur(m.warmFwd);
    $('fwdBwu').textContent = eur(m.bwuFwd);
    $('fwdInterest').textContent = eur(m.interestMonth);
    $('fwdRepay').textContent = eur(m.repayMonth);
    $('fwdOper').textContent = eur(m.warmFwd - m.bwuFwd - m.interestMonth - m.repayMonth);
  }

  drawAmort(p,m);
}

function bind(){ document.querySelectorAll('input').forEach(i=> i.addEventListener('input', ()=>render())); render(); }
window.addEventListener('DOMContentLoaded', bind);
</script>
</body>
</html>
